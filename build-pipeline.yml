trigger:
- main

jobs:
  - job: Build
    pool:
      name: Oracle VM
    steps:
      - task: NodeTool@0
        inputs:
          versionSource: "spec"
          versionSpec: ">=6.15.0"
        displayName: "Install Node.js"
      - script: |
          node -v
          echo $(pwd)
          echo $(ls)
          cd counters-backend/
          echo $(pwd)
          echo $(ls)
          npm install
          npm run build
        displayName: "npm install and build"
      - script: |
          echo "run frontend test"
          cd counters-frontend/
          npm run test
        displayName: "frontend component test"
      - script: |
          echo "run frontend linting"
          cd counters-frontend/
          npm run eslint
        displayName: "linting"
      - task: ArchiveFiles@2
        inputs:
          rootFolderOrFile: "$(System.DefaultWorkingDirectory)/counters-backend"
          includeRootFolder: false
          archiveType: zip
          archiveFile: $(Build.ArtifactStagingDirectory)/$(Build.BuildId).zip
          replaceExistingArchive: true
        displayName: "Archive files"
      - upload: $(Build.ArtifactStagingDirectory)/$(Build.BuildId).zip
        artifact: drop
        displayName: "Upload artifact"
